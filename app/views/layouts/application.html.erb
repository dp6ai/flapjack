<!DOCTYPE html>
<html>
<head>
  <title>Flapjack</title>
  <%= stylesheet_link_tag    "application", media: "all", "data-turbolinks-track" => true %>
  <%= javascript_include_tag "application", "data-turbolinks-track" => true %>
  <script src="http://js.pusher.com/2.1/pusher.min.js" type="text/javascript"></script>
  <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
  <%= javascript_include_tag "websocket_rails/main" if defined?(WebsocketRails) %>
  <%= csrf_meta_tags %>
</head>
<body>
<%= bootstrap_flash %>
<!-- navbar -->
<div class="navbar hidden-desktop">
  <div class="navbar-inner">
    <div class="container">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>
      <!-- Be sure to leave the brand out there if you want it shown -->
      <a class="brand" href="/">Flapjack</a>
      <!-- Everything you want hidden at 940px or less, place within here -->
      <div class="nav-collapse collapse ">
          <ul class="nav">
            <li>
              <a href="/photos/new">Create Photo</a>
            </li>
            <li>
              <a href="/links/new">Create Link</a>
            </li>
            <li>
              <a href="/notes/new">Create Note</a>
            </li>
            <li>
              <a href="/videos/new">Create Video</a>
            </li>
            <% unless current_user %>
                <li>
                  <a href="/users/sign_up">Sign Up</a>
                </li>
                <li>
                  <a href="/users/sign_in">Sign In</a>
                </li>
            <% else %>
                <li>
                  <%= link_to "Sign Out", destroy_user_session_path, method: :delete %>
                </li>
            <% end %>
          </ul>
        <!-- .nav, .navbar-search, .navbar-form, etc -->
        <%= render 'layouts/filter' %>
      </div>
    </div>
  </div>
</div>

<%= yield %>


<script>
  var $container = $('#iso-container');

  $container.isotope({
    itemSelector: '.post',
    masonry: {
      columnWidth: 120
    },
    sortBy: 'number'
  });

  // toggle variable sizes of all elements
  $('#toggle-sizes').find('a').click(function(){
  $container
  .toggleClass('variable-sizes')
  .isotope('reLayout');
  return false;
  });

//hover activates cursor and goes away when unhover

  // $(function(){    
  //   $('div.post').on('click', function(){
  //     $(this).find("input[type='text']").focus();
  //       $(this).find("input[type='image']").show();
  //     });
  // });

  // $(function(){    
  //     $('div.post').on('submit', function(){
  //         $(this).find("input[type='text']").blur();
  //         $(this).find("input[type='image']").hide();
  //     });
  // });


  // $(".post").hover(  
  //     function(){$(".multi-comment-overlay").animate({bottom: 50}, 500);  
  //   },  
  //     function(){$(".multi-comment-overlay").animate({bottom: -407}, 500);  
  // });

    $(".post").hover(
      function(){
        $(this).find('.multi-comment-overlay').stop(true, false).animate({bottom: 50}, 1050);
    }
    // );
      , 
        function(){
          $(this).find('.multi-comment-overlay').stop(true, false).delay(300).animate({bottom: -455}, 1050);
      });



</script>

        <script>
          commentOverlayOnPageLoad = function(){

                $('.page-load-comments-overlay').each(function(){
                    var idAttr = $(this).attr("id")
                    var id = idAttr.split("-").pop()
                    $.get("/posts/"+ id + "/last_five_comments", function(comments){


                      //calculate heights to determine number of posts to append
                      var bodyHeight1 = $("#post-"+id).find('.post-body-photo').height() || $("#post-"+id).find('.post-body-link').height() || $("#post-"+id).find('.post-body-video').height() || $("#post-"+id).find('.post-body-note').height();
                      var maxSizeOfList1 =  Math.round(bodyHeight1 / 20);
                      
                      if(comments.length - maxSizeOfList1 >0)
                      {
                         sliceNumber = comments.length - maxSizeOfList1
                      }
                      else{
                         sliceNumber = 0
                      }
                      clippedComments = comments.slice(sliceNumber)

                      $(clippedComments).each(function(){
                            $("#" + idAttr).append('<li><a href="/posts/' + this.post_id + '" data-id="' + this.post_id + '" class="follow-text">' + this.body + '</a> | <a href="/follow/comment/' + this.id + '" class="follow-user">' + this.user_id + '</a></li>');
                           
                      })                
                    })



                  })


          }

          window.onload = commentOverlayOnPageLoad();
        
              // get the post id from the id of each selection
              // use the id to make a get request
              // with response of get request, loop through and append each as an li element

          </script>
</body>
</html>
